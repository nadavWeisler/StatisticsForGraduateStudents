---
title: "Ex4"
author: "Nadav Weisler - 316493758, Gaya Aran - 209636885"
output: html_document
---

# Exercise 4

```{r}
setwd("SOME_PATH")
```

```{r warning=FALSE, message=FALSE}
require(ggplot2)
require(report)
require(effectsize)
require(dplyr)
require(emmeans)
require(pwr)
require(sjPlot)
require(ggeffects)
```

## Part 1

Load the dataset “ex4_data.csv”. The data was already cleaned and ready for 
analysis. It includes measurements from subjects who gave a speech in front of 
a crowd (each row is one subject):
  PS_score – a rating of an external judge (0-100) of how convincing the 
    participant’s speech was.
  Personality – a categorical variable describing each participant as 
    “extroverted”/”introverted”
  Caffeine – the amount of caffeine measured in the blood of the participants.
  Arousal – the average change in the pupil diameter of the subject during the 
    speech, compared to a baseline level.
  Age – subjects’ age
  
```{r}
df = read.csv("ex4_data.csv")
df
```

### Question 1

The first hypothesis you will test is that personality modulates the effect 
of arousal. Specifically, we hypothesize that while controlling for the effect 
of age, the relationship between caffeine level and public speaking (1) is 
positive on average, and (2) stronger for extraverted subjects than for 
introverted people.

#### a
-------
In this part we will learn how to conduct a power analysis for multiple 
regression model. For that, please read the appendix at the end.
Here, you are asked to perform a power analysis for the crucial interaction 
effect. Thus, your null model should be the same model you would use for 
testing the hypothesis but without the modulation of the caffeine effect by
personality. Assume that the R^2 of the null model is 0.18 and of the 
alternative model is 0.24.
What is the N needed for a power of 80%?
-------

We need 101 subjects for power of 80%.

```{r}
r2_a = 0.18
r2_ab = 0.24
u = 1

f2 = ((r2_ab - r2_a) / (1 - r2_ab))
pwr_result = pwr.f2.test(u = u, f2 = f2, sig.level = 0.05, power = 0.8)
subject_count = round(pwr_result$v) + u + 1
subject_count
```
#### b

-------
Perform the necessary transformations/coding to the categorical and 
continuous variables. Use a coding scheme where coefficients reflect the 
difference between levels of categorical variables and the grand mean when 
the continuous variables are set to 0.
-------

```{r}
df$personality = as.factor(df$personality)
contrasts(df$personality)[1,] = -1
df$caffeine = as.numeric(scale(df$caffeine))
df
```


#### c

-------
Run the relevant multiple regression and report it in a table. 
Include the estimate, t, score, df, and p-value for each predictor. 
Also report adjusted and unadjusted R2 for the model. 
-------

```{r}
model_1_1 = lm(PS_score ~ caffeine * personality + age, df)
summary(model_1_1)
table_1_1 = tab_model(model_1_1, show.df = T, show.stat = T)
table_1_1
```

#### d

-------
Print the VIF score of each predictor in the model. Should you be concerned 
about multicollinearity? Why? (Briefly - up to 30 words)
-------

There is no need to worry about multicollinearity because the variance inflation
factors (VIF) for our model's predictors are all below the threshold of 5 
(around 1)

```{r}
car::vif(model_1_1)
```

#### e

-------
Explain briefly the influences of your predictors on public speaking. Add a 
measure for the size of the hypothesized effects described above 
(in adjusted R2).
-------

By our data we can undestand that introvertion and caffeine effect public speaking, and caffeine effect more on extrovert peoples.

#### f

-------
Assuming that the effect of age, by itself, is not theoretically interesting,
why did we add it to the model? Suggest two possible reasons.
-------

#### g

Create an informative graph visualizing the model predictions (using ggpredict
as shown in the tutorial). The graph should be focused on the two effects that
were hypothesized, while considering the controlled variable (so if there was 
an effect, the graph should make it visible).

```{r}
plot(ggpredict(model_1_1, terms=c("caffeine", "age", "personality")))
```


### Question 2

-------
A colleague interested in the effect of caffeine (alone, regardless of 
personality and age) suggested that the reason caffeine influenced public 
speaking was because it was confounded with arousal. That is, according to your
colleague, caffeine did not directly influence public speaking, but rather 
through its indirect effect on arousal. 
-------

#### a

-------
Run the relevant models to test for this hypothesis and report the relevant 
measures for this hypothesis (including the direct and indirect effect, and the
coefficients of the model/s you have used), including the relevant estimates 
and p-values.
-------

```{r}
model_1_2 = lm(PS_score ~ (caffeine * arousal), df)
summary(model_1_2)
tab_model(model_1_2)
```


#### b 

Was the colleague correct? Briefly explain the way in which caffeine influences
performance.

YES

## Part 2

In this part you will analyze data from a single subject performing The 
Muller-Lyer task. The subject saw a target line (with six different lengths) 
with arrows pointing inward (>---<) or outward (<--->) and was tasked with 
identifying whether the line is longer or shorter than a reference line.

The relevant columns are:
  Left arrow – whether the arrows pointed inwards or outwards.
  length diff – The length of the target line minus the length of the reference 
    line (positive value indicate that the target line was longer)
  response – 1 for “target line longer”, 0 for “target line shorter”
  RT - response time

### Question 1

Preprocessing: 
-	Load the “Muller_Lyer_S2.csv” file.
-	Multiply length_diff by 100. 
-	Use effect-coding for the “left arrow” variable.
-	Subset the data to clean for RTs which were more than 2.5 SDs below or above
the overall mean. How many trials are left?

```{r}
muller_Lyer = read.csv("Muller_Lyer_S2.csv") 
```

```{r}
print("Init count: ")
print(nrow(muller_Lyer))
muller_Lyer$length_diff = muller_Lyer$length_diff * 100

muller_Lyer$left_arrow = as.factor(muller_Lyer$left_arrow)
contrasts(muller_Lyer$left_arrow)[1,] = -1

muller_Lyer["scaled_rt"] = scale(muller_Lyer$RT)
muller_Lyer = subset(muller_Lyer, abs(scaled_rt) <= 2.5)

print("After clean count: ")
print(nrow(muller_Lyer))
muller_Lyer
```

### Question 2

Run the relevant analysis to test the hypothesis that the probability to 
identify the target line as longer is modified by the difference in lengths 
and the arrows direction (without interaction). Report the coefficients of the
regression, their SE, and p-values, alongside the odds ratio for each predictor. 

```{r}
model_2 = glm(response ~ left_arrow + length_diff, data = muller_Lyer, family = "binomial")
model_2_summary = summary(model_2)
model_2_summary
tab_model(model_2, show.se = T, show.stat = T, show.fstat = T)
```

### Question 3

Explain the meaning of your results, including the meaning of the odds ratio.

```{r}

```

### Question 4

Visualize the results you got. You can use the predictions of the model with 
ggpredict or the results themselves with ggplot(…)+geom_smooth(…) or any other 
plotting function you want, as long as you make sure the graphs are 
understandable and coherent with complete labels.

```{r}
plot(ggpredict(model_2, terms=c("left_arrow", "length_diff")))
```

