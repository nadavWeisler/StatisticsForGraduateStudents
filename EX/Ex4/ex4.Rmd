---
title: "Ex4"
author: "Nadav Weisler - 316493758, Gaya Aran - 209636885"
output: html_document
---

```{r}
# setwd("SOME_PATH")
```

```{r warning=FALSE, message=FALSE}
require(ggplot2)
require(report)
require(effectsize)
require(dplyr)
require(emmeans)
require(pwr)
require(sjPlot)
require(ggeffects)
```

## Part 1
  
```{r}
df = read.csv("ex4_data.csv")
```

### Question 1

#### a

We need 101 subjects for power of 80%.

```{r}
r2_a = 0.18
r2_ab = 0.24
u = 1

f2 = ((r2_ab - r2_a) / (1 - r2_ab))
pwr_result = pwr.f2.test(u = u, f2 = f2, sig.level = 0.05, power = 0.8)
subject_count = round(pwr_result$v) + u + 1
subject_count
```

#### b

```{r}
df$personality = as.factor(df$personality)
contrasts(df$personality)[1,] = -1
df$caffeine = as.numeric(scale(df$caffeine))
```


#### c

```{r}
model_1_1 = lm(PS_score ~ caffeine * personality + age, df)
table_1_1 = tab_model(model_1_1, show.df = T, show.stat = T)
table_1_1
```

#### d

There is no need to worry about multicollinearity because the variance inflation
factors (VIF) for our model's predictors are all below the threshold of 5 
(around 1)

```{r}
car::vif(model_1_1)
```

#### e

By our data we can understand that introvertion and caffeine effect public 
speaking, and caffeine effect more on extrovert peoples.

#### f

Age could be a confound or external variable, that might effect the results. For instance, the effect of caffeine on bodily arousal and consequently on performance (such as public speaking) may change with age. Adding it helps us to control its possible influence and the noise in the results it could create.

#### g

Create an informative graph visualizing the model predictions (using ggpredict
as shown in the tutorial). The graph should be focused on the two effects that
were hypothesized, while considering the controlled variable (so if there was 
an effect, the graph should make it visible).

```{r}
plot(ggpredict(model_1_1, terms=c("caffeine", "age", "personality"))) + 
 labs(
    x = "Caffeine", 
    y = "Public Speaking", 
    title = "Predicted values in of Public Speaking",
    colour = "Age"
  )
```


### Question 2

#### a

```{r}
model_1_2 = lm(PS_score ~ (caffeine * arousal), df)
tab_model(model_1_2)
```

#### b 

The colleague is correct, we can see in our regression that the whole effect 
come from arousal, and caffeine is correlated with arousal, so that why we got
the significant result earlier.

## Part 2

### Question 1

```{r}
muller_Lyer = read.csv("Muller_Lyer_S2.csv") 
print("Init count: ")
print(nrow(muller_Lyer))
muller_Lyer$length_diff = muller_Lyer$length_diff * 100

muller_Lyer$left_arrow = as.factor(muller_Lyer$left_arrow)
contrasts(muller_Lyer$left_arrow)[1,] = -1

muller_Lyer["scaled_rt"] = scale(muller_Lyer$RT)
muller_Lyer = subset(muller_Lyer, abs(scaled_rt) <= 2.5)

print("After clean count: ")
print(nrow(muller_Lyer))
```

From 279 trials 268 left.

### Question 2

```{r}
model_2 = glm(response ~ left_arrow + length_diff, data = muller_Lyer, 
              family = "binomial")
tab_model(model_2, show.se = T, show.stat = T, show.fstat = T)
```

### Question 3

We fitted a logistic model to predict response with arrow direction and the 
arrows length. Both arrow direction and arrows length significantly predict
responses.
Outwards pointing arrows increase the odds of correct response, and it can be 
measured compared to inwards arrows by the model's coefficients (3.555). 
When increasing the length unit, the odds for correct response is increased by 
1.434.

### Question 4

```{r}
plot(ggpredict(model_2, terms=c("left_arrow", "length_diff"))) +
  labs(
    x = "Arrow Direction",
    y = "RT", 
    title = "Predicted probabilities of RT",
    colour = "Length difference"
  )
```

